import pathlib

import pandas as pd
import pytest

from stplfcnn.datareaders.pecanstreet import PecanStreetReader


@pytest.fixture
def pecanstreet_data(tmpdir) -> pathlib.Path:
    austin_path = tmpdir.mkdir("austin")
    austin_path.mkdir("H")
    austin_path.mkdir("15min")
    austin_path.join("austin_weather.csv").write(
        ",temperature,apparent_temperature,dew_point,humidity,visibility,pressure,wind_speed,cloud_cover,wind_bearing,precip_intensity,precip_probability\n"
        "2015-01-01 00:00:00-06:00,3.22,0.93,31.05,0.76,9.17,1029.56,5.27,1.00,1.00,0.02,0.28\n"
        "2015-01-01 01:00:00-06:00,3.33,1.29,31.81,0.78,9.11,1028.31,4.74,0.95,11.00,0.01,0.37\n"
        "2015-01-01 02:00:00-06:00,3.14,1.03,31.55,0.78,9.09,1027.27,4.85,0.90,9.00,0.01,0.48\n"
        "2015-01-01 03:00:00-06:00,2.69,0.53,31.16,0.80,9.00,1026.66,4.78,0.87,15.00,0.01,0.55\n"
        "2015-01-01 04:00:00-06:00,2.53,0.45,31.34,0.81,8.36,1026.81,4.56,0.90,9.00,0.02,0.51\n"
        "2015-01-01 05:00:00-06:00,1.84,-0.35,32.30,0.89,3.89,1027.16,4.53,0.96,349.00,0.05,0.43\n"
        "2015-01-01 06:00:00-06:00,1.72,-0.44,32.96,0.92,3.71,1026.50,4.45,1.00,358.00,0.03,0.38\n"
    )
    austin_path.join("H/austin_H_load.csv").write(
        ",1790,3577,5785,114,545,585,744,1192,1463,1642,1718,1800,2018,2129,2233,2337,2814,2818,2859,2945,3009,3039,3456,3482,3918,3967,4031,4767,4998,5403,5545,6423,6990,7536,7731,7940,8084,8236,8317,8767,8829,9121,9134,9160,9729,624,1953,2156,2199,2378,2787,2953,4220,4298,5026,5035,7390,7788,7951,2094,8626,890,7429,5892,4357,171,5439,4154,2829,9654,86,93,484,871,2171,3831,5218,5874,5949,6139,6730,7361,7769,7989,9019,9356,9609,9915,9922,9932,9935,9938,9942,2755,252,1103,1169,1283,1403,1415,1792,2925,2980,2986,3134,3367,3538,3935,4297,4373,5129,5738,5796,5921,6578,7560,7627,7739,7850,7900,8156,8386,9052,9971,9982,6498,1632,3392,8059,77,2072,3849,4352,4514,8086,8419,9248,4874,5677,946,7641,4641,8292,9875,6121,4946,8197,3500,4957,4213,9141,5568,9771,8079,5814,6692,9701,26,9484,434,1507,6412,1086,7901,7875,8645,7030,2557,6063,3649,8243,5889,781,8046,8163,7793,1700,2532,1202,5959,5060,5317,6165,59,101,3916,2472,9912,1500,8807,6691,6061,7787,7719,974,6348,8995,503,4473,5809,6460,3310\n"
        "2015-01-01 00:00:00-06:00,1.285,0.332,0.267,0.627,0.362,0.382,0.589,0.875,0.431,0.434,1.062,0.719,1.925,0.763,0.479,0.308,1.125,0.949,0.206,0.217,0.594,2.067,0.483,0.171,1.166,0.379,1.605,1.417,3.690,0.496,0.176,1.032,0.481,0.352,0.463,0.406,0.833,0.529,0.957,1.044,0.791,1.479,1.649,0.532,0.552,0.525,0.256,1.284,0.426,0.504,1.175,0.159,0.987,0.678,3.118,0.904,0.409,2.546,4.207,0.999,0.671,0.443,0.757,2.864,0.115,0.799,0.475,1.920,1.641,0.731,0.789,1.652,0.287,0.478,0.773,0.165,0.729,0.732,0.474,0.969,0.650,0.909,0.248,0.897,0.606,5.372,1.854,1.614,2.937,0.317,13.991,4.381,0.613,0.724,1.520,0.331,0.495,1.022,0.547,0.500,0.344,0.769,0.667,0.278,0.439,1.448,0.314,1.110,0.200,4.207,1.143,0.771,0.317,0.237,0.674,1.262,0.326,0.431,0.810,1.243,0.511,0.461,0.845,2.454,0.159,1.485,2.300,0.700,0.479,2.827,0.429,0.730,1.003,0.492,0.288,1.534,1.992,0.757,0.365,0.431,1.335,0.439,0.315,1.071,0.521,0.641,2.063,0.461,2.675,1.157,0.278,0.805,2.200,1.062,0.865,0.740,0.483,2.049,0.899,0.529,4.101,1.363,0.677,0.922,1.067,2.925,1.268,0.678,0.706,0.564,0.462,1.524,0.555,0.593,0.458,0.365,1.043,0.699,2.316,0.234,0.378,0.524,0.615,3.689,0.312,2.556,2.978,1.408,0.090,0.281,2.330,1.689,1.218,0.974,1.622,1.296,0.477,2.103,0.457,4.434,1.445,3.291\n"
        "2015-01-01 01:00:00-06:00,1.395,0.417,0.515,0.596,0.379,0.369,0.383,0.956,0.327,0.232,1.079,0.487,1.354,0.742,0.612,0.338,0.543,0.938,0.194,0.181,0.620,2.256,0.496,0.186,1.248,0.369,2.242,0.758,3.951,0.422,0.445,0.843,0.457,0.402,0.580,0.305,0.630,0.403,0.850,1.084,0.811,1.336,1.612,0.751,4.219,0.264,0.353,1.266,0.383,0.505,1.048,0.144,0.972,0.448,2.601,0.910,0.298,2.235,2.856,0.896,1.125,0.510,0.615,2.670,0.108,0.520,0.475,2.672,0.721,0.780,0.809,0.581,0.467,0.610,3.499,0.129,0.493,0.727,0.336,0.693,0.476,0.906,0.175,1.570,0.390,3.195,1.842,2.099,2.280,0.319,11.283,4.830,0.433,0.607,1.553,0.303,0.352,0.934,0.634,0.444,0.953,0.482,0.676,0.162,0.401,1.349,0.369,0.798,0.316,2.470,0.846,0.808,0.363,0.297,1.156,1.544,0.303,0.489,0.802,0.716,0.471,0.406,0.785,2.029,0.213,1.497,1.370,0.665,0.480,1.359,0.339,0.648,0.962,0.466,0.461,1.332,0.967,0.761,0.329,0.388,1.310,2.116,0.382,1.066,0.516,0.902,1.820,0.472,2.242,0.648,0.277,0.693,2.318,1.156,0.243,0.756,0.201,1.516,0.922,0.493,4.210,0.886,0.411,0.691,1.303,3.450,0.574,0.762,0.531,0.587,0.404,1.461,0.424,0.319,0.519,0.399,3.282,0.517,1.767,0.237,0.361,0.539,0.577,3.863,0.283,2.467,1.581,1.166,0.259,0.371,4.046,1.283,1.350,1.099,1.574,1.099,0.493,1.026,0.360,1.976,1.335,2.551\n"
        "2015-01-01 02:00:00-06:00,1.240,0.585,0.257,0.479,0.485,0.320,0.454,0.903,0.537,0.280,1.137,0.764,1.268,0.731,0.847,0.282,0.462,0.938,0.193,0.291,0.607,0.794,0.496,0.155,1.422,2.420,1.976,0.730,1.278,0.424,0.312,0.836,0.440,0.496,0.449,0.361,0.565,0.375,0.896,0.800,0.742,1.411,1.571,0.484,4.417,0.276,0.231,1.240,0.536,0.501,0.636,0.156,0.938,0.312,3.099,0.905,0.254,2.762,4.089,0.891,1.942,0.618,0.653,0.990,0.108,0.474,0.477,3.541,0.750,0.297,0.800,0.749,0.136,0.424,1.333,0.163,0.454,0.723,0.372,0.637,0.558,0.511,0.249,1.581,0.377,2.861,1.809,1.640,1.843,0.314,10.173,4.042,0.481,0.463,1.526,0.340,0.490,0.947,0.590,0.277,0.293,0.478,0.682,0.171,0.417,1.340,0.322,0.866,0.376,0.833,1.081,0.336,0.342,0.638,0.743,1.824,0.309,0.360,0.637,0.764,0.460,0.471,0.356,1.714,0.228,1.337,1.235,0.692,0.441,1.660,0.380,0.728,0.931,0.402,0.533,0.850,0.809,0.751,0.265,0.365,1.097,3.671,0.656,0.900,1.804,0.498,1.337,0.479,2.387,0.487,0.273,0.667,2.312,1.062,0.255,1.637,0.199,0.767,0.921,0.958,4.022,0.819,0.433,0.753,3.962,3.446,0.489,0.795,0.515,0.530,0.447,1.438,0.337,0.324,0.574,0.838,1.616,0.294,2.019,0.223,0.365,0.375,0.453,3.472,0.279,2.403,0.985,1.250,0.057,0.831,5.568,1.263,0.268,0.953,1.536,1.152,0.360,1.060,0.417,1.258,1.040,0.786\n"
        "2015-01-01 03:00:00-06:00,1.159,0.368,0.537,0.312,0.547,0.437,0.623,0.843,0.331,0.339,1.171,0.401,1.262,0.718,1.115,0.337,0.673,0.928,0.192,0.317,0.594,0.650,0.478,0.763,1.358,3.821,1.946,0.747,0.692,0.423,0.380,0.847,0.452,0.372,0.458,0.416,0.506,0.354,0.834,0.523,0.818,1.090,0.905,0.559,0.989,0.505,0.348,0.876,0.354,0.500,0.516,0.142,0.938,0.315,2.673,1.046,0.262,2.400,2.496,0.883,0.559,0.551,0.698,0.701,0.108,0.508,0.460,3.204,0.798,0.465,0.843,0.389,0.167,0.374,0.561,0.183,0.476,0.750,0.496,0.621,0.460,0.562,0.245,1.542,0.400,2.102,1.878,0.588,1.773,0.318,17.579,4.075,0.427,0.496,1.612,0.316,0.498,0.951,0.594,0.423,0.366,0.621,0.653,0.234,0.391,1.150,0.321,0.317,0.191,0.858,0.847,0.788,0.364,0.570,0.246,1.600,0.342,0.358,0.579,0.756,0.495,0.398,0.807,1.823,0.275,1.430,1.833,0.690,0.517,2.714,0.361,0.750,1.008,0.483,0.254,0.605,0.878,0.618,0.301,0.380,0.372,3.619,0.333,0.818,0.313,0.560,2.467,0.480,2.348,0.388,0.324,0.641,2.292,1.062,0.156,0.708,0.151,0.459,0.947,1.466,4.108,0.772,0.408,0.762,5.182,1.840,0.486,0.708,0.463,0.547,0.415,1.861,0.383,0.337,0.518,0.384,2.608,0.306,1.446,0.222,0.396,0.319,0.444,3.562,0.280,2.669,0.918,1.165,0.287,0.874,5.467,1.088,1.671,0.995,1.427,1.129,0.328,1.076,0.436,1.296,1.002,0.456\n"
        "2015-01-01 04:00:00-06:00,1.248,0.750,0.234,0.319,0.679,0.350,0.945,0.576,0.441,0.286,1.093,0.647,1.247,0.713,0.729,0.286,0.398,0.935,0.237,0.255,0.688,0.705,0.493,3.376,1.397,3.894,2.000,0.688,0.643,0.416,0.598,0.777,0.498,0.456,0.425,0.496,0.919,0.443,0.897,0.575,0.918,0.940,0.591,0.244,0.897,0.248,0.247,1.295,0.356,0.481,0.517,0.153,1.428,0.339,2.713,0.899,0.280,2.563,3.067,0.833,2.893,0.523,0.627,0.867,0.122,0.646,0.488,3.179,0.706,0.381,0.789,0.668,0.122,0.316,0.940,0.162,0.571,0.768,0.397,0.622,0.352,1.531,0.172,1.550,0.368,1.865,1.934,0.147,1.026,0.443,10.458,3.946,0.445,0.529,1.549,0.346,0.433,0.971,0.473,0.445,0.914,0.646,0.680,0.176,0.459,0.916,0.357,0.251,0.324,0.783,0.799,0.453,0.663,0.595,0.336,1.317,0.348,0.347,0.606,0.711,0.479,0.421,0.583,3.323,0.263,1.660,1.250,0.772,0.366,3.516,0.341,0.659,0.941,0.484,0.460,3.599,0.763,0.455,0.265,0.369,0.645,5.411,0.508,0.670,0.364,0.883,2.722,0.526,2.890,0.597,0.336,0.654,2.335,1.173,0.298,0.744,0.200,0.405,0.967,0.678,4.042,0.785,0.393,0.697,4.904,0.163,0.355,0.736,0.440,0.599,0.655,2.128,0.347,1.133,0.564,0.419,2.157,0.301,1.382,0.222,0.395,0.314,0.477,3.229,0.277,2.111,0.735,1.175,0.100,0.925,9.082,1.296,1.446,0.930,1.530,1.513,0.407,1.379,0.309,1.227,1.002,0.512\n"
        "2015-01-01 05:00:00-06:00,1.170,0.509,0.584,0.581,0.687,0.329,0.837,0.605,0.310,0.431,1.245,0.510,1.250,0.763,0.983,0.318,0.602,0.914,0.554,0.257,0.645,0.746,0.505,2.460,1.279,2.549,2.039,0.682,0.606,0.490,0.394,0.922,0.446,0.494,0.581,0.856,0.874,0.591,1.068,0.483,1.184,1.018,1.211,0.189,0.525,0.547,0.369,1.256,0.314,0.463,0.567,0.140,0.963,0.330,2.936,1.257,0.308,2.383,2.995,1.008,0.633,0.494,0.633,1.376,0.108,0.489,0.479,2.700,0.666,0.326,0.833,0.428,0.173,0.630,0.587,0.182,0.841,0.875,0.477,0.619,0.348,0.919,0.238,0.862,0.426,1.203,1.802,0.480,0.992,0.422,10.899,3.967,0.442,0.497,1.726,0.324,0.392,1.000,0.594,0.385,1.056,0.559,0.677,0.190,1.058,0.842,0.286,0.215,0.381,0.842,0.264,0.415,0.676,0.526,0.303,0.689,0.347,0.339,0.603,0.764,0.567,0.458,0.610,0.207,0.254,1.620,1.812,1.202,0.492,2.234,0.692,0.760,1.016,0.482,0.579,5.119,0.819,0.624,0.268,0.404,0.770,1.564,0.429,0.541,2.180,0.449,2.472,0.974,4.538,0.453,0.362,0.615,2.315,1.408,0.286,0.704,0.353,0.377,0.945,0.577,4.015,1.631,0.577,0.814,4.894,0.172,0.311,0.831,0.458,0.740,0.694,2.060,0.390,1.368,0.366,0.369,3.199,0.321,1.456,0.224,0.421,0.309,0.575,3.704,0.278,1.813,0.783,1.520,0.089,1.161,13.271,1.103,1.403,0.823,1.587,2.081,0.305,1.298,0.315,1.121,1.001,0.974\n"
        "2015-01-01 06:00:00-06:00,1.183,0.611,0.212,0.667,0.825,0.347,0.730,0.560,0.392,0.318,1.422,0.514,1.311,0.745,1.195,0.301,0.691,0.904,0.329,0.302,0.608,0.816,0.472,0.154,1.302,1.181,2.130,1.035,0.675,0.479,0.659,0.562,0.578,0.429,0.481,0.714,0.831,0.417,0.947,0.642,0.836,1.173,1.202,0.238,0.608,0.325,0.397,1.370,0.352,0.438,0.631,0.379,1.040,0.480,2.157,1.391,0.259,7.611,2.020,0.886,0.801,0.542,0.627,1.134,0.107,0.615,0.454,3.310,0.736,0.283,0.791,0.763,0.113,0.302,0.633,0.219,0.703,1.153,0.531,0.512,0.675,0.932,0.253,0.513,0.490,9.305,1.978,1.570,1.039,0.342,14.523,3.798,0.580,0.778,2.017,0.347,0.507,0.912,0.576,0.442,0.234,0.631,0.694,0.209,0.888,0.899,0.360,0.334,0.192,0.896,0.241,0.969,0.588,0.326,0.400,0.636,0.884,0.503,0.559,0.898,1.095,1.155,0.680,0.228,0.379,1.550,1.688,1.152,0.448,1.878,0.679,0.758,0.987,1.226,0.269,4.053,0.876,0.647,0.296,0.584,0.614,7.473,0.656,0.672,3.525,0.861,2.467,1.378,4.570,0.399,0.622,0.603,2.398,1.497,0.211,1.591,0.189,0.833,1.442,0.701,2.897,0.492,0.594,0.694,5.152,0.159,0.391,0.702,0.446,1.015,0.553,2.233,0.345,1.348,0.461,0.583,15.091,0.308,1.419,0.222,0.266,0.357,0.447,3.967,0.277,1.904,0.612,1.264,0.275,0.686,10.089,1.355,1.115,0.797,1.381,1.253,0.365,0.708,0.349,1.115,0.988,0.781\n"
    )
    austin_path.join("H/austin_H_load_agg_10.csv").write(
        ",10_1,10_2,10_3,10_4,10_5,10_6,10_7,10_8,10_9,10_10,10_11,10_12,10_13,10_14,10_15,10_16,10_17,10_18,10_19,10_20\n"
        "2015-01-01 00:00:00-06:00,5.584,7.753,12.067,6.272,7.998,15.180,10.417,7.049,15.403,24.122,9.774,7.214,12.221,8.020,10.679,9.910,14.271,8.249,12.832,16.600\n"
        "2015-01-01 01:00:00-06:00,5.569,6.467,12.547,5.998,11.499,12.408,10.196,8.345,13.252,21.373,7.976,7.326,9.275,6.652,11.473,8.574,13.405,9.328,11.468,14.304\n"
        "2015-01-01 02:00:00-06:00,5.539,6.913,10.300,5.530,11.409,14.041,9.849,5.791,11.742,19.329,5.778,7.034,8.594,6.014,13.316,9.051,15.762,8.109,10.470,13.837\n"
        "2015-01-01 03:00:00-06:00,5.495,7.116,11.473,5.140,6.944,11.671,8.050,4.860,9.868,26.971,5.102,6.451,10.981,5.636,11.697,8.205,15.276,8.479,10.913,14.913\n"
        "2015-01-01 04:00:00-06:00,5.828,6.542,14.300,6.083,6.218,12.790,10.432,5.356,9.387,19.595,5.507,6.174,12.634,8.335,15.217,7.790,13.113,9.306,9.738,19.120\n"
        "2015-01-01 05:00:00-06:00,6.043,7.396,12.001,6.710,7.076,12.888,7.905,5.645,7.692,20.226,6.105,4.925,9.455,10.763,14.369,7.941,14.445,10.446,10.654,23.306\n"
        "2015-01-01 06:00:00-06:00,5.844,7.713,8.852,6.261,6.939,16.854,8.607,5.720,17.098,24.480,5.338,6.005,10.253,10.374,22.616,10.087,12.544,22.564,10.055,18.528\n"
    )
    austin_path.join("15min/austin_15min_load_agg_50.csv").write(
        ",50_1,50_2,50_3,50_4\n"
        "2015-01-01 00:00:00-06:00,41.324,74.846,51.269,64.752\n"
        "2015-01-01 00:15:00-06:00,38.744,69.382,46.389,63.117\n"
        "2015-01-01 00:30:00-06:00,38.554,67.590,44.097,58.926\n"
        "2015-01-01 00:45:00-06:00,40.073,76.868,49.880,60.045\n"
        "2015-01-01 01:00:00-06:00,41.286,62.888,43.929,54.143\n"
        "2015-01-01 01:15:00-06:00,41.392,61.412,40.116,58.327\n"
        "2015-01-01 01:30:00-06:00,42.426,72.933,42.173,53.189\n"
        "2015-01-01 01:45:00-06:00,43.220,65.062,44.588,62.628\n"
        "2015-01-01 02:00:00-06:00,40.787,69.276,47.043,56.955\n"
        "2015-01-01 02:15:00-06:00,38.004,55.622,39.905,60.210\n"
        "2015-01-01 02:30:00-06:00,40.679,57.430,38.642,54.350\n"
        "2015-01-01 02:45:00-06:00,39.297,60.682,37.355,57.138\n"
        "2015-01-01 03:00:00-06:00,35.489,53.611,44.406,64.139\n"
        "2015-01-01 03:15:00-06:00,36.309,60.567,39.939,52.953\n"
        "2015-01-01 03:30:00-06:00,36.757,65.413,39.627,57.977\n"
        "2015-01-01 03:45:00-06:00,36.117,66.087,35.501,56.386\n"
        "2015-01-01 04:00:00-06:00,39.490,62.875,42.187,59.108\n"
        "2015-01-01 04:15:00-06:00,37.662,62.831,47.530,59.205\n"
        "2015-01-01 04:30:00-06:00,41.258,50.802,53.485,59.030\n"
        "2015-01-01 04:45:00-06:00,37.477,53.728,48.269,58.635\n"
        "2015-01-01 05:00:00-06:00,40.634,50.844,41.959,71.964\n"
        "2015-01-01 05:15:00-06:00,39.415,48.444,40.107,63.560\n"
        "2015-01-01 05:30:00-06:00,39.622,63.275,51.956,66.108\n"
        "2015-01-01 05:45:00-06:00,37.236,54.859,48.444,65.910\n"
        "2015-01-01 06:00:00-06:00,34.705,63.606,57.249,78.124\n"
        "2015-01-01 06:15:00-06:00,33.876,69.845,53.123,74.081\n"
        "2015-01-01 06:30:00-06:00,37.367,80.443,57.135,68.242\n"
        "2015-01-01 06:45:00-06:00,36.485,77.142,50.834,74.094\n"
    )
    return pathlib.Path(tmpdir)


def test_read_data(pecanstreet_data):
    # test H resolution
    reader = PecanStreetReader(pecanstreet_data, "austin", "H")
    data = reader.read_data()
    assert set(data.columns) == {
        "load", "temperature", "apparent_temperature", "dew_point", "humidity", "visibility", "pressure", "wind_speed",
        "cloud_cover", "wind_bearing", "precip_intensity", "precip_probability"
    }
    assert data.index.name == "timestamp"
    assert isinstance(data.index, pd.DatetimeIndex)
    assert data.index.freq == "H"
    assert data.index[0] == pd.Timestamp("2015-01-01 06:00:00")
    assert data.index[-1] == pd.Timestamp("2015-01-01 12:00:00")
    assert data.load[0] == pytest.approx(sum([
        1.285, 0.332, 0.267, 0.627, 0.362, 0.382, 0.589, 0.875, 0.431, 0.434, 1.062, 0.719, 1.925, 0.763, 0.479, 0.308,
        1.125, 0.949, 0.206, 0.217, 0.594, 2.067, 0.483, 0.171, 1.166, 0.379, 1.605, 1.417, 3.690, 0.496, 0.176, 1.032,
        0.481, 0.352, 0.463, 0.406, 0.833, 0.529, 0.957, 1.044, 0.791, 1.479, 1.649, 0.532, 0.552, 0.525, 0.256, 1.284,
        0.426, 0.504, 1.175, 0.159, 0.987, 0.678, 3.118, 0.904, 0.409, 2.546, 4.207, 0.999, 0.671, 0.443, 0.757, 2.864,
        0.115, 0.799, 0.475, 1.920, 1.641, 0.731, 0.789, 1.652, 0.287, 0.478, 0.773, 0.165, 0.729, 0.732, 0.474, 0.969,
        0.650, 0.909, 0.248, 0.897, 0.606, 5.372, 1.854, 1.614, 2.937, 0.317, 13.991, 4.381, 0.613, 0.724, 1.520, 0.331,
        0.495, 1.022, 0.547, 0.500, 0.344, 0.769, 0.667, 0.278, 0.439, 1.448, 0.314, 1.110, 0.200, 4.207, 1.143, 0.771,
        0.317, 0.237, 0.674, 1.262, 0.326, 0.431, 0.810, 1.243, 0.511, 0.461, 0.845, 2.454, 0.159, 1.485, 2.300, 0.700,
        0.479, 2.827, 0.429, 0.730, 1.003, 0.492, 0.288, 1.534, 1.992, 0.757, 0.365, 0.431, 1.335, 0.439, 0.315, 1.071,
        0.521, 0.641, 2.063, 0.461, 2.675, 1.157, 0.278, 0.805, 2.200, 1.062, 0.865, 0.740, 0.483, 2.049, 0.899, 0.529,
        4.101, 1.363, 0.677, 0.922, 1.067, 2.925, 1.268, 0.678, 0.706, 0.564, 0.462, 1.524, 0.555, 0.593, 0.458, 0.365,
        1.043, 0.699, 2.316, 0.234, 0.378, 0.524, 0.615, 3.689, 0.312, 2.556, 2.978, 1.408, 0.090, 0.281, 2.330, 1.689,
        1.218, 0.974, 1.622, 1.296, 0.477, 2.103, 0.457, 4.434, 1.445, 3.291]))
    assert len(data) == 7

    # test H resolution, agg 10, col 10_1
    reader = PecanStreetReader(pecanstreet_data, "austin", "H", 10, "10_1")
    data = reader.read_data()
    assert data.load[0] == 5.584

    # test 15min resolution, agg 50, col 50_1
    reader = PecanStreetReader(pecanstreet_data, "austin", "15min", 50, "50_1")
    data = reader.read_data()
    assert set(data.columns) == {
        "load", "temperature", "apparent_temperature", "dew_point", "humidity", "visibility", "pressure", "wind_speed",
        "cloud_cover", "wind_bearing", "precip_intensity", "precip_probability"
    }
    assert data.index.name == "timestamp"
    assert isinstance(data.index, pd.DatetimeIndex)
    assert data.index.freq == "15min"
    assert data.index[0] == pd.Timestamp("2015-01-01 06:00:00")
    assert data.index[-1] == pd.Timestamp("2015-01-01 12:45:00")
    assert data.load[0] == 41.324
    assert list(data.temperature[:5]) == pytest.approx([3.22, 3.2475, 3.275, 3.3025, 3.33])
    assert list(data.temperature[-4:]) == pytest.approx([1.72, 1.72, 1.72, 1.72])
    assert len(data) == 28
